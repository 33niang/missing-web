---
title: 以密码之剑护网安之盾
type: docs
draft: true
---

# 以密码之剑护网安之盾

{{<hint danger>}}
本文正在施工中……
{{</hint>}}

{{< hint info >}}

{{< /hint >}}

今天的世界已经离不开网络，从我们的日常生活到政府各项事务的管理，从企业的高效运转到顶尖的科学技术，网络已经成为了这一切的基石。可是你是否想过，这个网络世界其实「危机四伏」？我们在网络上传输的信息，可以很轻易地被拦截和篡改；国与国之间、企业与企业之间，网络更已经成为「没有销烟的战场」。在这样的环境之下，密码学技术帮助人们保护信息的安全，而在此基础之上，人们构建起了网络安全的完整体系。

## 危机四伏的世界

网络世界之所以「危机四伏」，从某种意义上来说，和当今互联网的底层技术——「分组交换」——脱不了干系。

我们说网络连接了世界的每一个角落，但这种连接并不是「点对点」的直接连接，而是由许多结点之间相互连接进行「转发」的。事实上，网络之所以称为「网络」，正是因为它在结构上由许多「结点」张成。今天，我们可以使用网络与远在地球另一端的朋友交流，并不是因为我们之间用一根无比长的网线牵着，而是因为我们之间有许许多多相互连接的结点，它们在我们之间搭成了一条「通路」。

为了提升传输的效率，网络会将我们需要发送的数据「切」成许多一定长度的小片段。这些片段就像一个个快递包裹一样，流入一个个结点。每个结点如同快递的转运中心，会根据片段上标记的「目的地」信息，将片段转发给去往目的地的下一个结点。就这样，经过一次又一次的转发，我们的数据片段最终都会抵达终点，并被重新组装为完整的数据。这种传输方式被称为「分组交换」，它奠定了互联网的传输基础。

这个过程看似十分完美，但在实际上充满危机。数据在网络上传输时可以很轻易地被截获，甚至对它们进行修改也不是什么难事。攻击者只需攻击、控制网络中的一个结点，所有经过它的数据片段都将被一览无余。在此之上，攻击者还可以修改数据片段里面的内容，使得最终发送到目的地的数据被篡改；或者将数据「拦下」，让目的地收到不完整的信息甚至完全收不到数据。攻击者甚至可以伪造我们的名字，以我们的名义发送伪造的信息，从而造成具有破坏性的后果。

如果将数据加密，这些问题就能得到一定程度的解决。加密后的信息即使被截获，攻击者也无法得知其中内容，更无从谈及篡改和伪造。密码技术的发展，让高效的加密成为了可能。接下来，让我们推开密码世界的大门，领略今天的密码之「剑」如何铸成。

## 蓬勃发展的密码学

### 人类的「传统艺能」

几千年来，人类的交锋见证了密码学的发展，从古代战场间的传令、军中机要情报的转移、能工巧匠家里的祖传秘方，到如今网络世界的信息流转……种种危机四伏的场景，如何让这些重要信息不被不相关的人员所知晓，便是这种「仅有我认识」的文字技艺的用武之地了。跨越几千年的时间长河，我们从头来看「密码」的力量如何铸就诸多信息的安全无虞。

<p style="font-size: 6px; font-weight: 100; color: lightgray; text-align-last:justify; margin: -4px">S t e g a n o g r a p h y</p>
让我们首先把目光投向密码学的孪生兄弟——「隐写术」（Steganography）。
「隐写术」，顾名思义，就是把重要信息「隐藏着写下来」，让读它的人基本不会注意到重要信息的手段。虽然它不算一种密码，但在「使信息对不知道的人来说很难看出来」这方面，它和密码是一样的。
古罗马的古典诗人奥维德就曾记录过用新鲜牛奶写信的隐写术——这样写在纸上的字很快就会消失不见，但是如果点燃字迹的一角，就可以将字迹显现出来。除了牛奶外，一些植物汁液、明矾、果汁等也被用作隐形墨水。另外一些隐写术则和今天学生的小抄有些类似——将信息写在树叶上、衣服里或是身体上，再运用多种方法进行遮掩。

与隐写术相比，密码学（Cryptography）的目标，则是将内容「变换」，使之变成常人看不懂的模样。公元前 5 世纪，古代的斯巴达人使用过一种叫做「密码棒」的器械，那是一根上面缠绕有羊皮纸条儿的木棍。人们把信息竖着写在羊皮纸条儿上，写完后将其从木棍上取下，原本的字母顺序就被打乱，难以再看出原本的信息。需要阅读时，只需取一根同样规格的木棍，将羊皮纸重新缠绕即可。这种密码棒是人类历史上已知的最早的密码器械。

据说古罗马的凯撒大帝使用过这样一种方法来保护重要的军事信息：将每个字母向后移动 3 位。例如，需要传递的信息是

```text
AMICUS PLATO, SED MAGIS AMICA VERITAS
```

将每个字母后推 3 位，即 A 变成 D，B 变成 E……可以得到下面的句子：

```text
DPLFXV SODWR, VHG PDJLV DPLFD YHULWDV
```

若不知道这种方式的具体细节——甚至，即使知道采用移动字母的方式，如果不知道具体移动的长度，他人就很难从后面这个句子猜出原本的内容。这种密码被称为「凯撒密码」。

在这些例子中，原本的可以直接理解的信息称为「明文」，经过处理后，难以理解的信息被称为「密文」。将明文转换为密文的过程被称为「加密」，而反向的过程就是「解密」。在加密和解密过程中，需要使用称为「密钥」的额外信息——就像一把钥匙一样，加密需要使用它，解密也需要用到。例如，对于密码棒来说，密码棒的尺寸信息是密钥。而对于凯撒密码，移动长度 3 这个数字就是它的密钥。

在古代，人们还发明过许多其他有趣的加密方式，如维吉尼亚密码。
维吉尼亚密码本质上是凯撒密码的一种改进——在凯撒密码中，每个字母前后推动的距离是固定的，而维吉尼亚密码通过构建一个「密码表」，将这一距离动态化，增加了破译的难度。

密码学伴随着人们保密意识的产生而诞生，然而直到 20 世纪 50 年代，密码学的本质并没有什么变化。各种加密方式都可以归类为「代换」和「置换」两种变换或它们的组合：「代换」指的是「用一种字母替代另一种字母」，而「置换」指的是「变更不同字母的位置」。上文提到的密码棒就是一种置换代码，而凯撒密码是一种代换密码。

在这一时期，密码的安全性，来源于代换和置换的精巧设计；而这样的设计，则基于经验或直觉。因此，此时的密码学更像是一门「艺术」——比起严格的论证，它的主观性更强。同时，这些密码大多可以通过频率分析的方法进行破解：由于文章、句子中不同字母的出现频率是存在规律的，通过对密文中字母的分布进行分析，就有可能反推出密码所使用的置换方式。现在，我们把这整个时期的密码学都称为「古典密码学」，而相关的密码则称为「古典密码」。

1949 年，美国数学家、工程师香农的《保密系统通信理论》（Communication Theory of Secrecy Systems）从数学和信息论的角度阐明了关于密码系统的分析、评价和设计的科学思想，提出了有关密码学的完整数学模型。简单来说，这篇论文用数学的语言，定量地描述了密码的「安全性」，以及与其相关的一系列概念，如密钥的复杂度、加密的复杂性等等。它让密码从一门基于感性构造、精巧设计的「艺术」，开始走向基于理论分析、实验验证的「科学」。
自此，密码学的发展有了理论的指导，密码学开始从人类的「传统艺能」向科学转变，近代密码学的序幕就此拉开。

### 对称密码的发展

#### 一把钥匙开一把锁

第二次世界大战期间，纳粹德国使用一种被称为「ENIGMA」（意为「谜」）的密码机来对军事通讯进行加密。这种密码机形如一台打字机，只不过相比于普通的打字机，它有着多个机械联动的转盘，每次按下一个键后，这些转盘就会按某种规则转动一次。转盘上设有触点，转盘之间亦有电路按某种规则相连接。当使用者按下键盘打字时，对应的电流依次通过各个转盘，最终被转换为其他的字母。由于转盘旋转，这种转换的对应关系在每次击键后都会变化，使得最终打出的文字与原文看起来毫无关系，字母之间的对应关系变得极其复杂。当需要解密消息时，只需要在另一台相同型号的密码机上设置相同的规则，即可打出原始的明文。许多历史学家认为，德军在战争前期的节节胜利和 ENIGMA 密码机不无关系，而盟军最终在西欧战场提前取胜，也大大得益于 ENIGMA 密码机的成功破译。

> 游戏《第五人格》中，玩家需要破译的「密码机」，原型就是 ENIGMA 密码机。

> 上节介绍了「明文」「密文」「密钥」的概念，ENIGMA 密码机的明文、密文和密钥是什么？
>

无论是凯撒密码还是 ENIGMA 密码机，它们都有一个共同的特征：**加密和解密过程使用相同的密钥**。如同现实生活中的钥匙和锁一样，我们使用同一把钥匙来上锁和开锁。这样的密码被称为「对称密码」。对称密码是最基本的一种密码形式，它符合我们对「加密」这件事的直觉，因此当密码学从古典时期迈向近代时，人们首先研究的，便是设计出安全、高效的对称密码。

#### 混淆与扩散

前文我们提到，古典密码的设计模式，总可以分成「代换」和「置换」两类。前者替换内容，后者更改位置。在近代密码学中，人们从信息论的角度对这两类方式进行了概括和发展，代换与置换法随之进化为「混淆」和「扩散」。

- 「混淆」旨在掩盖密文和明文之间的对应关系，最简单的方式是代换。为了增强混淆效果，则需要设计更加复杂的变换方式。ENIGMA 机通过多个旋转转盘改变字母映射，其实亦体现了混淆的思想。
- 「扩散」的目的是将单个字母加密所带来的影响扩大——举个例子，对一个字母进行加密，会改变密文中多个字母的表示。置换是扩散的最简单方式，但是置换的扩散能力非常有限（只能对其他地方的一个字母造成影响）。事实上，现如今使用的各种对称加密算法，都能做到「改变一小部分，密文的一大片都会改变」。

```text
使用 AES-128，CBC 模式，零向量作为 IV，PKCS5 填充
密钥：MISSING SEMESTER

明文：Your Missing Semester of Using Computer
密文：A1FDA643...81645F1B（16 进制，只展示开头和结尾）

明文：Our Missing Semester of Using Computer
密文：E3C68B01...88852E74（16 进制，只展示开头和结尾）
```

#### 数据加密标准（DES）

20 世纪 70 年代，随着美国政府对计算机安全问题开始重视，美国国家标准局（NBS，现为美国国家标准与技术研究院 NIST）开始征集用于政府内信息加密的加密算法。最终，IBM 公司提出的一套算法被采用，随后被命名为「数据加密标准」（Data Encryption Standard，简称 DES）并公布。DES 算法采用了一种被称为「分组加密」的思路——将不同长度的明文先切割成固定长度为 64 位的块，再逐块进行加密，块与块之间的加密可以互相影响。DES 将一块块 64 位的明文加密成 64 位的密文，再将它们合成为一条完整的密文。解密时，只需反向对密文进行切割再逐块解密即可。

而在 DES 对每一块加密的过程中，都会使用 56 位长度的密钥来**循环进行包含代换和置换的操作多达 16 次**（这个结构被称为费斯妥结构）。在这其中的代换部分，DES 使用一套预先设计好的代换表（称为「S 盒」）进行。例如，使用如下的 S 盒时，输入数据 46（二进制 `100110`），就能得到代换后的结果 8。DES 一共有 8 个这样的 S 盒 {{<katex>}}S_1{{</katex>}} 至 {{<katex>}}S_8{{</katex>}}，它们互不相同，每个都是经过特定设计得到的，可以在加密过程中引入复杂性来防止被轻易破解。

(没找到合适的 S1 的 Markdown 图，之后再补)

> 想知道 DES 的具体过程？受限于篇幅和本文的定位，我们在此处不作过多介绍，你可以自己上网搜索。
>

1975 年，DES 正式对外公布，并在 1976 年被定为美国联邦标准。DES 的提出，在密码学历史上具有里程碑式的意义。在 DES 公开后，没过几年，它就成为了世界上使用最为广泛的加密算法：美国政府使用 DES 存储重要信息，大型企业使用 DES 保护商业秘密。美国银行业将 DES 作为批发银行业标准。另一方面，DES 所使用的分组加密思想、费斯妥结构和密钥扩展等思路，启发着无数后继加密算法的研究。

然而，有关 DES 算法本身的争论从它诞生开始就没有停息。围绕 DES 算法本身，争论的焦点有两个：其一便是 56 位的密钥是否足够安全。任何密码都存在被暴力破解，也就是通过穷举所有可能的密钥来破解的可能，而实际实施破解的难度会随着计算技术的发展快速下降：在 1977 年——也就是 DES 成为联邦标准的次年——就有学者构想了一台造价 2000 万美元，可以在 1 天内暴力破解 DES 密码的机器。到了 1993 年，同类机器的理论成本降到了 100 万美元，时间缩短到 7 小时。而在 1998 年，一台造价只有 25 万美元的破解机器被实际制造出来，从此针对 DES 的破解成为事实上的可能。除了暴力破解外，一系列更高效的破解算法亦于上世纪末被提出，它们让 DES 从「安全无比」的神坛上跌落，向人们昭示着密钥长度的重要性。

而有关 DES 的另一个争论，便是其神秘的 S 盒设计。我们刚才提到，DES 一共使用了 8 个 S 盒用于执行代换，而这些 S 盒是被人为设计出来并公开给大众使用的——那么，为什么这些 S 盒要这样设计呢？它们是否真的足够「安全」？尽管 S 盒的设计声称安全无比，并能防御多种破解方式，但是这些设计是否存在不为人知的甚至是**刻意留下的**漏洞呢？由于 IBM 并没有完全公开 S 盒是如何设计的，这些问题变成了悬在人们头上的利剑，而执剑人则隐藏在黑暗之中。人们开始思考，能否让 S 盒的构造方式变得透明，同时仍然保持足够的安全。

基于各种安全原因，1999 年，DES 被要求「只能在遗留系统中使用」，新的系统必须使用 DES 的升级版——三重 DES（Triple DES，简称 TDES 或 3DES），即使用两个密钥进行 3 次 DES 加密。2005 年，美国官方不再使用 3DES，但美国国家标准和技术研究院（NIST）仍然保留了 3DES 作为可选标准。2018 年，NIST「退役」3DES，从此 3DES 只能在老旧的系统中使用，各种软件纷纷开始移除对 3DES 的支持。2024 年 1 月 1 日，NIST 正式撤销有关 3DES 的使用建议，自此 3DES 在美国被完全弃用，而各地的软件厂商亦已完全转为使用更安全的加密算法。属于 DES 的时代画上了句号，而它的后继者——高级加密标准（Advanced Encryption Standard，简称 AES）则在今天继续守护着我们的安全。

#### 高级加密标准（AES）

上世纪末，DES 逐渐被证明不再安全。人们除了「亡羊补牢」式地急忙提出 3DES 算法外，，亦开始寻找新的更安全的加密算法。NIST 开始征集新的加密算法，在经过数年的甄选后，由比利时密码学家 Joan Daemen 和 Vincent Rijmen 所设计的一款算法最终脱颖而出，于 2001 年被命名为「高级加密标准」（AES）并公布。自此，属于 DES 和 3DES 的时代开始落幕，而直到今天，AES 仍然是事实上最被广泛使用的对称加密算法，并且依然有着无与伦比的安全性。

和 DES 一样，AES 也是一种分组密码，不过分组长度为 128 位。AES 同样采用了代换置换结合的方式完成一轮加密操作，亦通过多次的循环来确保安全性。不过，AES 使用的结构与 DES 不同（不是费斯妥结构）。AES 可以选择 128 位、192 位和 256 位三种不同长度的密钥，远远安全于 DES 的 56 位。同时，相比于 DES 使用人工设计的 S 盒，AES 在执行代换操作时的 S 盒是使用数学方法构造的，因此其不存在被留下刻意漏洞的空间，同时又能保证代换具有足够的安全性。

> AES 的 S 盒核心是在有限域 {{<katex>}}GF(2^8){{</katex>}} 上针对素多项式 {{<katex>}}m(x) = x^8 + x^4 + x^3 + x + 1{{</katex>}} 进行的求逆运算。
>

AES 优秀的算法设计使其保持着足够的安全性。直到今天，人们仍然没有发现实用的针对 AES 的破解方法。自 2002 年 AES 被 NIST 采用为标准以来，AES 已经成为了最流行的对加密算法，在我们的生活中几乎无处不在。例如，你正在浏览的《你缺计课》网站本身，就是使用 AES 加密后安全地传输到你的手机或电脑上的；在我们的手机、电脑内部，操作系统亦大量使用 AES 来加密存储敏感数据，以防止设备失窃后的隐私泄露。

### 非对称密码的兴起

#### 令人头疼的密钥交换

对称密码的不断发展，让数字时代资料的保密存储成为了现实。然而，无论是 DES、3DES 还是 AES，这些对称密码在用于数据传输时都有一个问题：加密和解密用的密钥，如何安全地在双方之间共享呢？

或许你会说，只要提前将密钥发送给对方就行了。但是请别忘记，我们之所以要进行加密的通信，正是因为通信的环境不安全——在本章开头我们就提到，网络世界「危机四伏」。所以，提前将密钥发送给对方，就有可能造成非常严重的后果——我们的「钥匙」可能被恶意地拦截、伪造甚至调包，让之后的一切加密都形同虚设。你也许还会想到，能否通过物理上安全的方式——比如，线下碰个面——来提前沟通密钥呢？对于一些情况这样做似乎可行，但如果通信双方是未曾谋面的陌生人，恐怕就不太方便了。在这样的背景之下，寻找一种**不需要提前共享相同密钥，就能实现加密通信**的方式，成为了摆在我们面前的现实问题。

我们想象一个现实的场景。在那交通还不发达的古代，小明和小红相隔千里，现在，小明要将一则非常重要的机密信息用鸡毛信的方式传递给小红。由于路途漫长，信件在传递过程中几易其手，很难保证不被好事之人窥探。为了保证信息的安全，小明想到了一个这样的方法：

- 首先，小明让小红制作了一个带锁的信封。这种锁和我们日常生活中用的门锁类似，锁上后需要用钥匙打开，但是开锁后用力一扣就能锁上，无需钥匙。
- 接着，小红先把这个信封上的锁打开，将信封寄给小明，但钥匙留在自己手上。
- 小明收到信封之后，把需要寄出的机要信息装进信封，用力一扣——现在，信封被锁上，除了小红以外的任何人都无法打开它了。
- 最后，小明把这个装好信件的上锁信封寄给小红。小红收到后，用自己手里的钥匙将信封打开，取出信息。

在这样的过程中，通信双方之间并没有提前交换过任何「钥匙」，只要锁本身足够安全，就可以确保只有小红自己能取出信件，而负责发信的小明并不接触钥匙。当小红需要回复一则消息给小明时，也只需要先让小明也做一个同类的信封，再对称地进行一篇同样的流程即可。

我们可以看到，在这套不用提前交换钥匙就能实现双向保密的过程中，「带锁的信封」是关键。这个带锁的信封具有一个重要的「非对称」性质：上锁只需要用力扣上，而开锁需要使用钥匙。将这个过程类比到加密、解密的过程，我们自然而然地想到——如果能设计一种加密和解密使用两把不同密钥的加密算法，不就可以完美地解决本节开头提到的那个问题了吗？

> 思考一下，如何解决？
>

假设现在有一种加密算法，使用密钥 P 将明文加密，但是加密后的内容要使用密钥 S 来解开。小明需要向小红安全地发送一则消息，只需要先让小红准备一对这样的 P 和 S。小红将密钥 S 保留在手中，将密钥 P 发送给小明——不必考虑安全与否，甚至，小红直接将密钥 P 公之于天下也行。小明看到后，将手中的消息使用小红的密钥 P 加密，再将密文直接发送给小红。现在，只有小红手里的密钥 S 能解开这则密文，而密钥 S 始终留在小红自己的手里。信息被安全地传输，而用于解密的密钥全程没有被交换过。

由于密钥 P 是被小红主动公开的，因此我们称为「公钥」；密钥 S 始终留在小红自己手里，我们称为「私钥」。公钥用于将明文加密成密文，而私钥用于解密。小红持有的公钥和私钥，只适用于别人向她发送消息；因此，通信各方都需要准备一对自己的公钥和私钥，并各自将公钥公开给他人。这样的加密方式被称为「公钥密码」；又由于公钥、私钥的非对称性，也被称为「非对称密码」。

这个系统看起来完美得不得了，只不过有一个小小的问题——这样神奇的加密算法真的能存在吗？还真别说，真就给人们找出来几个。

#### 单向函数与公钥加密

先来做两个数学题：

1. 计算 {{<katex>}}97\times 47{{</katex>}} 的值；
2. 已知两个质数 {{<katex>}}p{{</katex>}} 和 {{<katex>}}q{{</katex>}} 满足 {{<katex>}}p\times q=4559{{</katex>}}，求 {{<katex>}}p{{</katex>}} 和 {{<katex>}}q{{</katex>}}。

如果你真去算了两道题的结果，就会发现它们互为答案，并且各自是对方唯一的答案。然而，做这两道题的难度，则完全不在一个数量级：对于第一题，只需要简单的竖式乘法就能算出来，或许你还可以直接口算甚至心算；但对于第二题，除了从 2 开始逐个质数地尝试，没有什么好方法了。可以想象，如果这样的 {{<katex>}}p{{</katex>}} 和 {{<katex>}}q{{</katex>}} 大到一定程度，就能让计算机也几乎解不出问题 2。同时，问题 1 的乘法计算依然能高效的解决。如果把这样的运算视为函数，它们被称为「单向函数」，「单向」即表示它们「往一个方向运算容易，倒过来运算非常困难」的特性。



### （国产密码的发展）